<div id="content">
    <sa-widgets-grid>
        <!-- row -->
        <div class="row">
            <!-- ADD PATIENT WIDGET START -->
            <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <!-- Widget ID (each widget will need unique ID)-->
                <sa-widget>
                    <header>
                        <h2>
              <strong>Dispense</strong></h2>
                    </header>
                    <!-- widget div-->
                    <div role="content">
                        <!-- widget edit box -->
                        <div class="jarviswidget-editbox">
                            <!-- This area used as dropdown edit box -->
                        </div>
                        <!-- end widget edit box -->
                        <!-- widget content -->
                        <div class="widget-body">
                            <form>
                                <fieldset class="col-xs-24 col-sm-6 col-md-6 col-lg-6">
                                    <legend>Dispensing Information</legend>
                                    <div class="row">
                                        <div class="form-group col-xs-6 col-sm-6 col-md-6 col-lg-6">
                                            <label>Select Dispensing Point</label>
                                            <select class="form-control" id="select-1" placeholder="Select One">
                                                <option>Select One</option>
                                                <option>Main Store</option>
                                                <option>Pharmacy</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="form-group col-xs-12 col-sm-6 col-md-6 col-lg-6">
                                            <label>Patient Number CCC</label>
                                            <input class="form-control" placeholder="autofilled" type="text" [(ngModel)]="patient.ccc_number" name="ccc_number" disabled>
                                        </div>
                                        <div class="form-group col-xs-12 col-sm-6 col-md-6 col-lg-6">
                                            <label>Patient Name</label>
                                            <input class="form-control" placeholder="autofilled" type="text" [(ngModel)]="patient.first_name" name="first_name" disabled>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="form-group col-xs-12 col-sm-6 col-md-6 col-lg-6">
                                            <label>Dispensing Date</label>
                                            <div class="input-group">
                                                <input type="text" name="mydate" placeholder="Select a date" class="form-control datepicker" [saUiDatepicker]="{ dateFormat: 'dd/mm/yy' }">
                                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                            </div>
                                        </div>
                                        <div class="form-group col-xs-12 col-sm-6 col-md-6 col-lg-6">
                                            <label>Purpose of Visit</label>
                                            <select class="form-control" id="select-1">
                                                <option selected>Select One</option>
                                                <option>Enrollment</option>
                                                <option>Routine Refill</option>
                                                <option>PEP Refill</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="form-group col-xs-12 col-sm-6 col-md-6 col-lg-6">
                                            <label>Current Height (CM)</label>
                                            <input class="form-control" placeholder="autofilled" [(ngModel)]="patient.current_height" name="current_height" type="text">
                                        </div>
                                        <div class="form-group col-xs-12 col-sm-6 col-md-6 col-lg-6">
                                            <label>Current Weight (KG)</label>
                                            <input class="form-control" placeholder="autofilled" [(ngModel)]="patient.current_weight" name="current_weight" type="text">
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="form-group col-xs-12 col-sm-6 col-md-6 col-lg-6">
                                            <label>Days to Next Appointment</label>
                                            <input class="form-control" placeholder="autofilled" #box (blur)="nextAppointment(box.value)" [(ngModel)]="ctrl" type="text" name="days_to">
                                        </div>
                                        <div class="form-group col-xs-12 col-sm-6 col-md-6 col-lg-6">
                                            <label>Date of Next Appointment</label>
                                            <div class="input-group">
                                                <input type="text" name="mydate" placeholder="Select a date" class="form-control datepicker" [saUiDatepicker]="date_options" [setDate]='setdate' (selectDate)="dateDiff($event)">
                                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                            </div>
                                        </div>
                                        <div class="form-group col-xs-12 col-sm-6 col-md-6 col-lg-6">
                                            <label>Last Regimen Dispensed</label>
                                            <input class="form-control" placeholder="autofilled" type="text" disabled>
                                        </div>
                                        <div class="form-group col-xs-12 col-sm-6 col-md-6 col-lg-6">
                                            <label>Current Regimen</label>
                                            <select class="form-control" id="select-1" name="current_regimen" [(ngModel)]="current_regimen" (click)="setDrug(current_regimen)">
                                                <option *ngFor="let regimenDrug of regimenDrugs" value={{regimenDrug.id}}>{{regimenDrug.name}}</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="form-group col-xs-12 col-sm-6 col-md-6 col-lg-6">
                                            <label>Appointment Adherance (%)</label>
                                            <input class="form-control" placeholder="autofilled" type="text">
                                        </div>
                                        <div class="form-group col-xs-12 col-sm-6 col-md-6 col-lg-6">
                                            <label>Poor/Fair Adherance Reasons</label>
                                            <select class="form-control" id="select-1">
                                                <option>Select One</option>
                                                <option>Toxicity/Side Effects</option>
                                                <option>Share with Others</option>
                                                <option>Forgot</option>
                                                <option>Felt Better</option>
                                            </select>
                                        </div>
                                    </div>
                                </fieldset>
                                <fieldset class="col-xs-24 col-sm-6 col-md-6 col-lg-6">
                                    <legend>Previous Patient Information</legend>
                                    <div class="form-group col-xs-12 col-sm-6 col-md-6 col-lg-6">
                                        <div class="form-group">
                                            <label>Appointment Date</label>
                                            <div class="input-group">
                                                <input type="text" name="mydate" placeholder="Select a date" class="form-control datepicker" [saUiDatepicker]="{ dateFormat: 'dd/mm/yy' }" disabled>
                                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group col-xs-12 col-sm-6 col-md-6 col-lg-6">
                                        <label>Previous Visit Date</label>
                                        <div class="input-group">
                                            <input type="text" name="mydate" placeholder="Select a date" class="form-control datepicker" [saUiDatepicker]="{ dateFormat: 'dd/mm/yy' }" disabled>
                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                        </div>
                                    </div>
                                    <div class="form-group col-xs-12 col-sm-12 col-md-12 col-lg-12">
                                        <div role="content">
                                            <div class="widget-body">
                                                <div class="table-responsive">
                                                    <table class="table table-bordered">
                                                        <thead>
                                                            <tr>
                                                                <th [ngStyle]="{width:'70%'}">Drug Dispensed</th>
                                                                <th>Quantity Dispensed</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                <td>Bang Bang</td>
                                                                <td>50mg</td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>
                                <fieldset class="col-xs-48 col-sm-12 col-md-12 col-lg-12">
                                    <legend>Drug Details <button class=" btn btn-default pull-right" (click)="addRow()">Add</button></legend>
                                    <div class="col-sm-24">
                                        <div role="content">
                                            <div class="widget-body">
                                                <div class="table-responsive">                                                   
                                                    <form action="" [formGroup]="dispenseTableForm" (ngSubmit)="save()">
                                                        <div formArrayName="dispenseTable" *ngFor="let row of rows.controls; let i=index">
                                                            <div [formGroupName]="i">
                                                                <table id="disp_table" class="table table-bordered">
                                                                    <thead>
                                                                        <tr>
                                                                            <th>Drug</th>
                                                                            <th>Unit</th>
                                                                            <th>Batch No.</th>
                                                                            <th>Expiry Date</th>
                                                                            <th>Dose</th>
                                                                            <th>Expected Pill Count</th>
                                                                            <th>Actual Pill Count</th>
                                                                            <th>Duration</th>
                                                                            <th>Quantity Dispensed</th>
                                                                            <th>Stock on Hand</th>
                                                                            <th>Indication</th>
                                                                            <th>Comment</th>
                                                                            <th>Missed Pills</th>
                                                                            <th>Action</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        <tr>
                                                                            <td id="complex_table">
                                                                                <select class="form-control" id="input" *ngIf="regimen" formControlName="drug" id="">
                                                                                    <option value="" *ngFor="let drug of regimen.drugs" value="{{drug.id}}">{{drug.name}}</option>
                                                                                </select>
                                                                            </td>
                                                                            <td id="complex_table">
                                                                                <input class="form-control" id="input" type="text" formControlName="unit">
                                                                            </td>
                                                                            <td id="complex_table">
                                                                                <select class="form-control" formControlName="batch_no" id=""></select>
                                                                            </td>
                                                                            <td id="complex_table">
                                                                                <input class="form-control" id="input" type="text" formControlName="expiry_date">
                                                                            </td>
                                                                            <td id="complex_table">
                                                                                <input class="form-control" id="input" type="text" formControlName="dose">
                                                                            </td>
                                                                            <td id="complex_table">
                                                                                <input class="form-control" id="input" type="text" formControlName="exp_pill_count">
                                                                            </td>
                                                                            <td id="complex_table">
                                                                                <input class="form-control" id="input" type="text" formControlName="actual_pill_count">
                                                                            </td>
                                                                            <td id="complex_table">
                                                                                <input class="form-control" id="input" type="text" formControlName="duration">
                                                                            </td>
                                                                            <td id="complex_table">
                                                                                <input class="form-control" id="input" type="text" formControlName="dispensed_qty">
                                                                            </td>
                                                                            <td id="complex_table">
                                                                                <input class="form-control" id="input" type="text" formControlName="stock">
                                                                            </td>
                                                                            <td id="complex_table">
                                                                                <select class="form-control" id="input" *ngIf="regimen" formControlName="indication" id="">
                                                                                    <option *ngFor="let indication of regimen.drugs['indication']" value="{{indication.id}}">{{indication.name}}</option>
                                                                                </select>
                                                                            </td>
                                                                            <td id="complex_table">
                                                                                <input class="form-control" id="input" type="text" formControlName="comment">
                                                                            </td>
                                                                            <td id="complex_table">
                                                                                <input class="form-control" id="input" type="text" formControlName="missed_pills">
                                                                            </td>
                                                                            <td id="complex_table">
                                                                                <button class="btn btn-danger" (click)="removeRow(i)">Remove</button>
                                                                            </td>
                                                                        </tr>
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </form>
                                                    {{ dispenseTableForm.value | json}}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-12" align="right" style="padding-bottom:30px">
                                        <input type="reset" class="btn btn-danger button_size" value="Reset Fields">
                                        <button class="btn btn-primary" type="submit"><i class="fa fa-print"></i> Print Labels</button>
                                        <button class="btn btn-primary" type="submit"><i class="fa fa-save"></i> Dispense Drugs</button>
                                    </div>
                                </fieldset>
                            </form>
                        </div>
                    </div>
                </sa-widget>
            </article>
        </div>
    </sa-widgets-grid>
</div>